# JSONP安全性总结

- [JSONP安全漏洞分析](#jsonp安全漏洞分析)
    - [Callback参数注入](#callback参数注入)
    - [DOM注入](#dom注入)
    - [资源访问](#资源访问)

## JSONP安全漏洞分析

### Callback参数注入

可以利用Callback参数向页面注入并执行js脚本，从而获取用户数据等信息。

防御方法：参考[XSS攻击](XSS攻击.md)

- 白名单字符过滤

    也可以采用黑名单，但是JS中恶意字符的变形十分多，需要枚举所有非法字符，可能存在疏漏。

- 严格控制Callback格式。

    对于Callback参数作严整的格式检查，或强制约定指定格式。
    
    该方法基本可以彻底解决安全问题，但同样是对调用端不是完全透明，使用者需要额外去知晓相关限制和约定，可能会造成不必要的沟通成本。
   
- 敏感资源保护起来

### DOM注入

返回包体添加`header`头部，强制指定`MIME`类型，避免按`HTML`方式解析，防止XSS漏洞。

### 资源访问

防止JSONP资源被滥用。

防止非法站点利用JSONP获取系统信息。

解决防范：

- 来源refer白名单匹配

验证是授权站点才可以访问JSONP资源。

- cookieToken机制来限制

服务器必须拿到cookie中存储的token信息，才允许访问JSONP资源。